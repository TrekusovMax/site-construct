import{u as T,a as R,g as M,b as P,r as c,j as s,P as F,B as p,T as E,c as z,d as B,e as $,v as K,f as C,L as O,h as H,m as Q,i as L}from"./index-c322cabe.js";import{S as b}from"./site-show-6c20fb21.js";import{I as U}from"./input-578891f6.js";const X="site_card_RCjb",q="site_card_head_NRV9",G="site_card_title_pfrH",J="site_card_buttons_ofJm",V="site_card_fork_count_UfDh",j={site_card:X,site_card_head:q,site_card_title:G,site_card_buttons:J,site_card_fork_count:V},k=({site:t,onDeleteSite:n})=>{var _;const a=T(),e=R(M),[r,{isLoading:o}]=P(),[i,u]=c.useState(!0),d=f=>{a(`/sites/${f}`)};c.useEffect(()=>{!o&&!i&&n()},[o]);const l=()=>{r(t.id),i&&u(!1)};return s.jsxs("div",{className:j.site_card,style:{backgroundColor:t.bg},"data-testid":t.id,children:[s.jsxs("div",{className:j.site_card_head,children:[s.jsx("h3",{className:j.site_card_title,children:t.name}),s.jsxs("div",{className:j.site_card_fork_count,children:[s.jsx(F,{})," ",(_=t==null?void 0:t.forkCount)==null?void 0:_.toString()]})]}),t.authorId===e&&s.jsxs("div",{className:j.site_card_buttons,children:[s.jsx(p,{onClick:()=>d(t.id),typeButton:E.primary,children:"Редактировать"}),s.jsx(p,{onClick:l,typeButton:E.failed,isLoading:o,children:"Удалить"})]})]})},W="sites_list_QCO9",Y="sites_list_container_h5HU",Z="sites_list_item_zDbP",ss="sites_list_not_sites_title_BTFQ",ts="show_site_button_78jv",m={sites_list:W,sites_list_container:Y,sites_list_item:Z,sites_list_not_sites_title:ss,show_site_button:ts},es=(t,n)=>{switch(t){case"NAME.ASK":return n.sort((a,e)=>a.name>e.name?1:-1);case"NAME.DESC":return n.sort((a,e)=>a.name>e.name?-1:1);case"DATE.ASK":return n.sort((a,e)=>e.updatedAt-a.updatedAt);case"DATE.DESC":return n.sort((a,e)=>a.updatedAt-e.updatedAt);default:return n}},as=()=>{const[t,n]=c.useState([]),[a,e]=c.useState(1),[r,o]=c.useState(!1),[i,u]=c.useState(!0),[d,l]=c.useState(""),{data:_,isLoading:f}=z({startAt:d,limitToFirst:10},{refetchOnMountOrArgChange:!0});c.useEffect(()=>{if(_)if(_.slice(-1)[0].id!==d){const v=i?_:_.slice(1);n(g=>[...g,...v]),o(!0),u(!1)}else o(!1)},[_]),c.useEffect(()=>()=>{w()},[]),c.useEffect(()=>{if(r&&_){const x=_.slice(-1)[0].id;l(x)}},[a]);const w=()=>{n([]),e(1),o(!1),u(!0),l("")},S=c.useRef(null),y=c.useCallback(x=>{f||(S.current&&S.current.disconnect(),S.current=new IntersectionObserver(v=>{v[0].isIntersecting&&r&&e(g=>g+1)}),x&&S.current.observe(x))},[f,r]);return{data:t,lastNodeRef:y,isLoading:f,refreshSiteList:w}},ns="site_fork_8YMd",rs={site_fork:ns},A=({site:t,onSuccess:n})=>{const[a,{isSuccess:e}]=B(),[r]=$(),o=R(M);c.useEffect(()=>{e&&t.authorId!==o&&(r({id:t.id,forkCount:t.forkCount+1}),n())},[e]);const i=()=>{const d=String(new Date).split(" ").slice(1,5).join(" ");a({...t,name:`${t.name} (${d})`,id:K(),authorId:o,updatedAt:Date.now(),forkCount:0})};return s.jsx(p,{onClick:i,className:rs.site_fork,children:s.jsx(F,{})})},cs=()=>{const{data:t,lastNodeRef:n,isLoading:a,refreshSiteList:e}=as(),[r]=C(),o=r.get("sort")||"",i=r.get("search")||"",u=(t==null?void 0:t.filter(l=>l.name.toLowerCase().includes(i.toLowerCase())))||[],d=es(o,u);return s.jsx("div",{className:m.sites_list,children:s.jsxs("div",{className:m.sites_list_container,children:[t&&t.length===0&&s.jsx("h3",{className:m.sites_list_not_sites_title,children:"Сайты не найдены"}),t&&!!d.length&&d.map((l,_)=>d.length===_+1?s.jsxs("div",{ref:n,className:m.sites_list_item,children:[s.jsx(k,{site:l,onDeleteSite:e}),s.jsx(b,{site:l,className:m.show_site_button}),s.jsx(A,{site:l,onSuccess:e})]},l.id):s.jsxs("div",{className:m.sites_list_item,children:[s.jsx(k,{site:l,onDeleteSite:e}),s.jsx(b,{site:l,className:m.show_site_button}),s.jsx(A,{site:l,onSuccess:e})]},l.id)),a&&s.jsx(O,{})]})})},os="search_a0Ka",is="search_input_9P0e",ls="search_icon_rDS3",N={search:os,search_input:is,search_icon:ls},ds=(t,n)=>{const a=c.useRef(t),e=c.useRef();c.useEffect(()=>{a.current=t},[t]);const r=c.useCallback(()=>{e.current=setTimeout(()=>a.current(),n)},[n]),o=c.useCallback(()=>{e.current&&clearInterval(e.current)},[]);return c.useEffect(()=>(r(),o),[n,r,o]),{reset:c.useCallback(()=>{o(),r()},[o,r]),clear:o}},_s=(t,n,a)=>{const{reset:e,clear:r}=ds(t,n);c.useEffect(e,[...a,e]),c.useEffect(r,[])},us=t=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",className:"bi bi-search",viewBox:"0 0 16 16",...t,children:s.jsx("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})}),hs=({placeholder:t})=>{const[n,a]=C(),e=n.get("search")||"",[r,o]=c.useState(e),i=d=>{n.set("search",d),a(n)};_s(()=>i(r),1e3,[r]);const u=d=>{o(d.target.value)};return s.jsx("div",{className:N.search,children:s.jsx(U,{className:N.search_input,onChange:u,value:r,placeholder:t,rightIcon:s.jsx(us,{className:N.search_icon})})})},ms="main_s7Py",fs="main_filters_gOKX",D={main:ms,main_filters:fs},xs="sort_6SCW",js="sort__icon_HF5z",Ss="sort__icon_active_a0wX",ps="sort_list_XzJ2",vs="sort_list_item_f1n-",h={sort:xs,sort__icon:js,sort__icon_active:Ss,sort_list:ps,sort_list_item:vs},gs="dropdown_Sjhu",Ns="dropdown_active_07nb",I={dropdown:gs,dropdown_active:Ns},Cs={open:{opacity:1,y:0},closed:{opacity:0,y:"10%"}},ws=({isOpen:t,iconRef:n,handleClick:a,children:e})=>{const r=c.useRef(null);return H(n,r,()=>a()),s.jsx(Q.nav,{className:L(I.dropdown,t&&I.dropdown_active),ref:r,animate:t?"open":"closed",transition:{duration:.5},variants:Cs,children:e})},Es=t=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-filter-left",viewBox:"0 0 16 16",...t,children:s.jsx("path",{d:"M2 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"})}),bs=()=>{const[t,n]=C(),a=t.get("sort")||"",[e,r]=c.useState(!1),o=c.useRef(null),i=u=>{t.set("sort",u.target.value),n(t),setTimeout(()=>r(!1),500)};return s.jsxs("div",{className:h.sort,children:[s.jsx(p,{className:L(h.sort__icon,e&&h.sort__icon_active),onClick:()=>r(!e),children:s.jsx(Es,{})}),s.jsx(ws,{isOpen:e,iconRef:o,handleClick:()=>r(!1),children:s.jsxs("div",{className:h.sort_list,children:[s.jsxs("div",{className:h.sort_list_item,children:[s.jsx("input",{type:"radio",name:"sort",onChange:i,id:"sort-1",value:"NAME.ASK",checked:a==="NAME.ASK"}),s.jsx("label",{htmlFor:"sort-1",children:"a-z"})]}),s.jsxs("div",{className:h.sort_list_item,children:[s.jsx("input",{type:"radio",name:"sort",onChange:i,id:"sort-2",value:"NAME.DESC",checked:a==="NAME.DESC"}),s.jsx("label",{htmlFor:"sort-2",children:"z-a"})]}),s.jsxs("div",{className:h.sort_list_item,children:[s.jsx("input",{type:"radio",name:"sort",onChange:i,id:"sort-3",value:"DATE.ASK",checked:a==="DATE.ASK"}),s.jsx("label",{htmlFor:"sort-3",children:"Сначала новые"})]}),s.jsxs("div",{className:h.sort_list_item,children:[s.jsx("input",{type:"radio",name:"sort",onChange:i,id:"sort-4",value:"DATE.DESC",checked:a==="DATE.DESC"}),s.jsx("label",{htmlFor:"sort-4",children:"Сначала старые"})]})]})})]})},Is=()=>s.jsxs("div",{className:D.main,children:[s.jsxs("div",{className:D.main_filters,children:[s.jsx(hs,{placeholder:"Поиск по названию"}),s.jsx(bs,{})]}),s.jsx(cs,{})]});export{Is as default};
